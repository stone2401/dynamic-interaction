# 系统架构概览

本文档描述了项目的整体架构设计、核心概念和技术亮点。

**适用对象:** 架构师、技术负责人

## 1. 系统概述

本项目是一个基于 Node.js 的交互式 AI 代理系统，旨在提供一个 Web UI 界面，使用户能够与 AI 模型进行多模态（文本和图片）交互，并实时接收 AI 的工作摘要和日志输出。其核心目标是实现 AI 代理与用户之间的高效、可靠的双向通信和反馈机制。

系统的高层级视图如下：

```
+-----------------------+
|       AI Agent        |
+-----------+-----------+
            |
            | MCP (Model Context Protocol)
            |
+-----------v-----------+
|    MCP Server (Node.js) |
| (src/mcp/index.ts)    |
+-----------+-----------+
            |
            | WebSocket / HTTP
            |
+-----------v-----------+
|     Backend Server    |
|   (Node.js/Express)   |
| (src/server/*.ts)     |
+-----------+-----------+
            |
            | WebSocket / HTTP
            |
+-----------v-----------+
|      Frontend UI      |
| (HTML/CSS/TypeScript) |
| (src/public/*)        |
+-----------+-----------+
            |
            | User Interaction
            |
+-----------v-----------+
|         User          |
+-----------------------+
```

**核心功能**：

*   **多模态交互**：支持用户通过文本和图片与 AI Agent 进行交互。
*   **实时反馈**：AI Agent 的工作摘要和日志实时推送到前端。

## 5. 关键技术栈

本项目主要基于以下关键技术构建：

*   **Node.js**：作为后端运行环境，提供高性能的 JavaScript 运行时。
*   **Express.js**：轻量级的 Node.js Web 应用框架，用于构建后端 HTTP 和 WebSocket 服务器。
*   **TypeScript**：JavaScript 的超集，提供了静态类型检查，增强了代码的可维护性和开发效率。
*   **WebSocket**：实现客户端与服务器之间的全双工通信，支持实时数据传输。
*   **Model Context Protocol (MCP)**：用于 AI Agent 与外部工具和服务进行交互的协议，本项目中用于 AI Agent 与用户界面之间的通信。
*   **Winston**：Node.js 的日志库，提供了灵活的日志记录功能，支持多种传输方式（包括自定义的 WebSocket 传输）。
*   **marked.js**：前端 Markdown 解析库，用于将 AI Agent 返回的 Markdown 格式内容渲染为 HTML。
*   **highlight.js**：前端代码高亮库，用于美化代码片段的显示。
*   **lucide**：轻量级、可定制的开源图标库，用于前端界面的图标显示。

## 扩展性考虑

本项目在设计时考虑了未来的扩展性，主要体现在以下几个方面：

*   **模块化设计**：后端和前端都采用了模块化的设计，各个功能模块职责清晰，降低了耦合度。这使得新增功能或修改现有功能时，可以只关注特定模块，而不会影响整个系统。
*   **MCP 协议**：通过 MCP 协议与 AI Agent 解耦，这意味着可以轻松更换或升级底层的 AI 模型，而无需修改核心业务逻辑。只要新的 AI Agent 遵循 MCP 协议，就可以无缝集成。
*   **会话管理**：`SessionManager` 和 `SessionQueue` 的设计使得会话管理独立于具体的业务逻辑。这为未来支持多用户、多会话并发提供了基础，可以通过扩展会话存储（例如，使用 Redis 等外部存储）来支持更大量的并发会话。
*   **日志系统**：基于 Winston 的日志系统支持多种传输方式，可以方便地集成到集中式日志管理系统（如 ELK Stack）中，以应对大规模部署时的日志收集和分析需求。
*   **懒启动机制**：HTTP 服务器的懒启动机制确保了资源的高效利用，尤其是在多实例部署时，可以避免不必要的资源开销，有助于水平扩展。
*   **前端可插拔**：前端模块（如 `feedback.ts`, `imageHandler.ts`, `statusBar.ts` 等）设计为相对独立，可以根据需求进行增删改。例如，可以轻松添加新的 UI 组件或交互模式，以支持更多模态的交互。
*   **配置化**：通过环境变量进行配置，使得部署和管理更加灵活。在不同的部署环境下，只需修改环境变量即可适应，无需修改代码。

未来可以考虑的扩展方向：

*   **多租户支持**：在会话管理层增加租户隔离，支持多个独立的用户群体。
*   **持久化存储**：将会话数据、用户偏好等存储到数据库中，以便在应用重启后恢复会话状态。
*   **负载均衡**：在前端和后端之间引入负载均衡器，以支持高并发和高可用性。
*   **容器化部署**：使用 Docker 和 Kubernetes 进行容器化部署，进一步提高部署的灵活性、可伸缩性和管理效率。
*   **更丰富的交互模态**：除了文本和图片，未来可以扩展支持语音、视频等更多模态的交互。
